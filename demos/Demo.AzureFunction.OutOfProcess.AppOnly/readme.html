<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>PnP Core SDK - Azure Function v4 Sample using out-of-process with .NET 6 | PnP Core SDK </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="PnP Core SDK - Azure Function v4 Sample using out-of-process with .NET 6 | PnP Core SDK ">
    <meta name="generator" content="docfx 2.56.5.0">
    <meta name="description" content="The PnP Core SDK is a modern .NET SDK designed to work for Microsoft 365. It provides a unified object model for working with SharePoint Online and Teams which is agnostic to the underlying API's being called.">
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    <meta property="docfx:newtab" content="true">
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../images/logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/pnp/pnpcore/blob/dev/docs/demos/Demo.AzureFunction.OutOfProcess.AppOnly/readme.md/#L1" title="Improve this Doc" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
                    <h1 id="pnp-core-sdk---azure-function-v4-sample-using-out-of-process-with-net-6">PnP Core SDK - Azure Function v4 Sample using out-of-process with .NET 6</h1>

<p>This solution demonstrates how to build a simple backend API in the form of an HTTP Trigger Azure Function. The sample contains a <code>ProvisionSite</code> function that creates a new site collection including a new site page containing some text and an image. This Azure function is using application permissions (app-only).</p>
<h2 id="source-code">Source code</h2>
<p>You can find the sample source code here: <a href="https://github.com/pnp/pnpcore/tree/dev/samples/Demo.AzureFunction.OutOfProcess.AppOnly">/samples/Demo.AzureFunction.OutOfProcess.AppOnly</a></p>
<div class="NOTE">
<h5>Note</h5>
<p>This sample was created with Visual Studio 2022 using .NET 6.0 and has been tested with a Windows Azure Function v4 running out-of-process (so using process isolation).</p>
</div>
<h2 id="sample-configuration">Sample configuration</h2>
<div class="NOTE">
<h5>Note</h5>
<p>For the sample setup, you will need to have a recent version of <a href="https://pnp.github.io/powershell/">PnP.PowerShell</a> installed on your machine.</p>
</div>
<h3 id="create-and-configure-the-azure-ad-application">Create and configure the Azure AD application</h3>
<p>Using PnP PowerShell this becomes really simple. Below cmdlet will create a new Azure AD application, will create a new self-signed certificate and will configure that cert with the Azure AD application. Finally the right permissions are configured and you're prompted to consent these permissions.</p>
<pre><code class="lang-powershell"># Ensure you replace contoso.onmicrosoft.com with your Azure AD tenant name
# Ensure you replace joe@contoso.onmicrosoft.com with the user id that's an Azure AD admin (or global admin)

Register-PnPAzureADApp -ApplicationName FunctionDemoSiteProvisiong -Tenant contoso.onmicrosoft.com -Store CurrentUser -GraphApplicationPermissions &quot;Sites.FullControl.All&quot; -SharePointApplicationPermissions &quot;Sites.FullControl.All&quot; -Username &quot;joe@contoso.onmicrosoft.com&quot; -Interactive
</code></pre>
<div class="IMPORTANT">
<h5>Important</h5>
<p>Once this cmdlet is done you do need to to copy <strong>certificate thumbprint</strong> and <strong>ClientId</strong> values as these will be needed for the configuration step</p>
</div>
<p>If you prefer to manually create and configure the Azure AD application then follow these steps:</p>
<ol>
<li>Create a new (self-signed) certificate</li>
<li>Create a new Azure AD application and take note of the shown <strong>Application (client) ID</strong></li>
<li>Under <strong>Certificates &amp; secrets</strong> upload your certificate and take note of the shown <strong>thumbprint</strong></li>
<li>Under <strong>API permissions</strong> add these two <strong>application</strong> permissions:
<ol>
<li>Microsoft Graph -&gt; <code>Sites.FullControl.All</code> application permission</li>
<li>SharePoint -&gt; <code>Sites.FullControl.All</code> application permission</li>
</ol>
</li>
<li>Click on <strong>Grant consent for</strong> to consent the permissions for the application</li>
</ol>
<h3 id="configure-the-samples-configuration-file">Configure the sample's configuration file</h3>
<p>The demo function needs a configuration file named <code>local.settings.json</code>, copy the <code>local.settings.copyme.json</code> file into a file named <code>local.settings.json</code> and in the file properties set <code>Copy to output directory</code> to <code>Copy if newer</code>.</p>
<p>Once that's done you do have this file in project:</p>
<pre><code class="lang-json">{
  &quot;IsEncrypted&quot;: false,
  &quot;Values&quot;: {
    &quot;AzureWebJobsStorage&quot;: &quot;UseDevelopmentStorage=true&quot;,
    &quot;FUNCTIONS_WORKER_RUNTIME&quot;: &quot;dotnet-isolated&quot;,
    &quot;SiteUrl&quot;: &quot;&lt;base site collection url to connect to&gt;&quot;,
    &quot;TenantId&quot;: &quot;&lt;tenant id&gt;&quot;,
    &quot;ClientId&quot;: &quot;&lt;application client id&gt;&quot;,
    &quot;CertificateThumbPrint&quot;: &quot;&lt;thumbprint&gt;&quot;,
    &quot;WEBSITE_LOAD_CERTIFICATES&quot;: &quot;&lt;thumbprint&gt;&quot;
  },
  &quot;Host&quot;: {
    &quot;CORS&quot;: &quot;*&quot;
  }
}
</code></pre>
<p>After filling in the configuration data your file will look like this:</p>
<pre><code class="lang-json">{
  &quot;IsEncrypted&quot;: false,
  &quot;Values&quot;: {
    &quot;AzureWebJobsStorage&quot;: &quot;UseDevelopmentStorage=true&quot;,
    &quot;FUNCTIONS_WORKER_RUNTIME&quot;: &quot;dotnet-isolated&quot;,
    &quot;SiteUrl&quot;: &quot;https://contoso.sharepoint.com&quot;,
    &quot;TenantId&quot;: &quot;9bd71689-66cb-4560-bb09-ab908ec21437&quot;,
    &quot;ClientId&quot;: &quot;8bb62681-cddd-41e0-bfdf-ab908ec8a3c3&quot;,
    &quot;CertificateThumbPrint&quot;: &quot;1C3342BA9B5269FDBCDCAB5D6334F1A60C73B184&quot;,
    &quot;WEBSITE_LOAD_CERTIFICATES&quot;: &quot;1C3342BA9B5269FDBCDCAB5D6334F1A60C73B184&quot;
  },
  &quot;Host&quot;: {
    &quot;CORS&quot;: &quot;*&quot;
  }
}
</code></pre>
<h2 id="run-the-sample">Run the sample</h2>
<p>If you're using Visual Studio then press F5 to launch the sample, if you're using command line then use <code>func start</code>.</p>
<div class="NOTE">
<h5>Note</h5>
<p>To use command line you first have to install the <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local?tabs=v4%2Cwindows%2Ccsharp%2Cportal%2Cbash%2Ckeda#v2">Azure function core tools version 4.x</a></p>
</div>
<p>With the sample running go to your browser and load this url: <code>http://localhost:7071/api/CreateSite?owner=joe@contoso.onmicrosoft.com&amp;sitename=azurefunctiondemo001</code>, doing this will call into your Azure function passing the owner of the site collection that will be created and the site collection name. You have to update the url parameters accordingly, above sample will result in a site collection with url <a href="https://contoso.sharepoint.com/sites/azurefunctiondemo001">https://contoso.sharepoint.com/sites/azurefunctiondemo001</a> having joe@contoso.onmicrosoft.com set as owner.</p>
</article>
          </div>
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              </nav>
            </div>
          </div>        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>PnP Core SDK<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
            
            <img src="https://telemetry.sharepointpnp.com/@pnp.github.io/index/" alt="spacer">
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>  </body>
</html>